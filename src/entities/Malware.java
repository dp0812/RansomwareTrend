package entities;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;

import fileReader.WritableObject;
/**
 * To holds all the possible attribute of a recorded Malware in the frequently updated MalwareBazaar dataset, in the appropriate data type. 
 */
public class Malware implements WritableObject{
    private LocalDateTime firstSeenUtc;
    private String firstSeenUtcString; //MUST RETURN THIS IN THE GET INFO.
    private String sha256Hash;
    private String reporter; 
    private String fileName;
    /** Ex: "elf" Executable and Linkable Format */
    private String fileTypeGuess;
    /** Ex: "application/x-dosexec" */
    private String mimeType;
    /** Ex: Mirai, Njrat */
    private String signature;

    public Malware(){}
    public Malware(
        String first_seen_utc, 
        String sha256_hash, 
        String reporter,
        String file_name, 
        String file_type_guess, 
        String mime_type, 
        String signature)
        {
        //parse String to LocalDateTime objects. 
        //strip " from string, or else it can't be parse into LocalDateTime object.
        first_seen_utc = first_seen_utc.replaceAll("\"","" ); 
        DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss");
        LocalDateTime formattedFirstSeenUtc = LocalDateTime.parse(first_seen_utc, formatter);
        
        this.firstSeenUtcString = formatter.format(formattedFirstSeenUtc);
        this.firstSeenUtc = formattedFirstSeenUtc;   
        this.sha256Hash = sha256_hash;
        this.reporter = reporter;
        this.fileName = file_name;
        this.fileTypeGuess = file_type_guess;
        this.mimeType = mime_type;
        this.signature = signature;
    }

    /**
     * Get a String array of the category of the objects.
     * @param object extract visualization info from this object.
     * @return String array 
     */
    public static String[] getVisualizationInfoArray(Malware object){
        String[] visualizationInfo = {
            "first_seen_utc",
            "sha256_hash",
            "reporter",
            "file_name",
            "file_type_guess",
            "mime_type",
            "signature"        
        };
        return visualizationInfo;
    }

    /** 
     * Get a String array that contains, in this exact order:
     * first_seen_utc, sha256_hash, reporter, 
     * file_name, file_type_guess, mime_type, signature
     * Use for writing info to file. 
     */
    public String[] getInfoArr(){
        String[] infoArr = {
            this.firstSeenUtcString,
            this.sha256Hash,
            this.reporter,
            this.fileName,
            this.fileTypeGuess,
            this.mimeType,
            this.signature
        };
        return infoArr; 
    }

    public LocalDateTime getDateTime(){
        return this.firstSeenUtc;
    }
    public String getFileType(){
        return this.fileTypeGuess;
    }
    public String getMimeType(){
        return this.mimeType;
    }
    public String getSignature(){
        return this.signature;
    }

    @Override
    public String toString(){
        String result ="";
        String[] infoArr = getInfoArr();
        for (String s: infoArr){
            result+= (s + "\n");
        }
        return result;
    }
}
